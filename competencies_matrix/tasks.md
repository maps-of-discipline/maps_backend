# Список Задач по Разработке Веб-приложения "Матрицы Компетенций"

**Проект:** Академический Прогресс / Карты Дисциплин (Бэкенд + Фронтенд)
**Компонент:** `competencies_matrix`
**Версия Документа:** 3.6 *(Фокус на UI формирования ПК, отображение рекомендованных ПС, улучшение удаления ФГОС)*
**Дата:** 2025-05-26

---

## Глоссарий Сокращений

*(Сохраняем глоссарий без изменений, он находится в файле structure.md)*

---

## 0. Приоритет и Цель MVP (Minimum Viable Product) - До Защиты (ОБНОВЛЕНО)

**Приоритет:** Создать **функциональный и понятный Frontend**, демонстрирующий основной **workflow просмотра и ручного редактирования** матрицы компетенций ("Дисциплина ↔ ИДК"), **просмотр справочников НСИ (ФГОС, ПС, Компетенции, Индикаторы)** и **ручного создания Профессиональных Компетенций (ПК) и Индикаторов их Достижения (ИПК) на основе данных из загруженных Профстандартов**.

**Источник данных:**
*   **Дисциплины АУП:** Получать из **внешней БД "Карты Дисциплин"** через API бэкенда `/api/competencies/external/aups` и `/api/competencies/external/aups/<aup_id>/disciplines`.
*   **УК/ОПК/ИУК/ИОПК:** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db` или `import-fgos`).
*   **Профессиональные Стандарты (ПС) и их структура (ОТФ, ТФ, ТД, НУ, НЗ):** Из **локальной БД** модуля `competencies_matrix` (наполненной **механизмом импорта из XML**).
*   **ПК/ИПК:** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db` + **ручной ввод через UI/API с использованием данных из загруженных ПС**).
*   **ФГОС (для просмотра):** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db` или `import-fgos`).
*   **Связи Матрицы:** Из **локальной БД** модуля `competencies_matrix`, управляемой через UI/API `/api/competencies/matrix/link`.

**DoD для MVP (к защите):**
1.  **Бэкенд:**
    *   [x] Настроенный проект с актуальной схемой БД.
    *   [x] Рабочее подключение ко внешней БД КД.
    *   [x] API для поиска АУП из КД (`GET /external/aups`).
    *   [x] API для получения дисциплин АУП из КД (`GET /external/aups/<aup_id>/disciplines`).
    *   [x] API для получения данных матрицы (`GET /matrix/<aup_num>`), использующий дисциплины из КД.
    *   [x] API для ручного создания/удаления связей в матрице (`POST/DELETE /matrix/link`).
    *   [x] API для получения списка и деталей ФГОС (`GET /fgos`, `GET /fgos/<id>`).
    *   [x] API для загрузки, предпросмотра и сохранения ФГОС из PDF (`POST /fgos/upload`, `POST /fgos/save`, `DELETE /fgos/<id>`).
        *   [x] **(Backend): `models.py`: Добавить `recommended_ps_parsed_data = db.Column(db.JSON, nullable=True)` в `FgosVo` для хранения сырых данных рекомендованных ПС из PDF.**
        *   [x] **(Backend): `logic.py`: Модифицировать `save_fgos_data`: после парсинга PDF сохранять `parsed_data.get('recommended_ps', [])` в `fgos_vo.recommended_ps_parsed_data` как JSON-строку.**
        *   [x] **(Backend): `logic.py`: Модифицировать `get_fgos_details`:
            *   Десериализовать `fgos.recommended_ps_parsed_data`.
            *   Для каждого ПС из десериализованных данных проверить, существует ли он в БД.
            *   Сформировать список `recommended_ps_list` для ответа, включающий для каждого ПС: `id`, `code`, `name` (из БД, если есть), `name_from_parsed_doc` (из `recommended_ps_parsed_data`), `is_loaded: boolean` (флаг, загружен ли ПС в БД).**
    *   --- **Импорт Профстандартов (ПС)** ---
    *   [x] **(Backend): `parsers.py`: Переработан для парсинга ПС из XML-файлов.**
    *   [x] **(Backend): `logic.py`: Переработан `save_prof_standard_data` для сохранения полной структуры ПС (ОТФ, ТФ, ТД, НУ, НН).**
    *   [x] **(Backend): `routes.py`: Обновлен API `POST /profstandards/parse-preview` для приема XML-файлов и вызова нового парсера.**
    *   [x] **(Backend): `routes.py`: Обновлен API `POST /profstandards/save` для сохранения полной структуры ПС.**
    *   [x] API для получения списка ПС (`GET /profstandards`). *Обновить, чтобы возвращал только базовую информацию без полной структуры для списка.*
        *   [x] **(Backend): `logic.py`: Модифицировать `get_prof_standards_list`: для каждого `ProfStandard` получить список ФГОС, которые его рекомендуют (`recommended_by_fgos: [{ id: FgosVo.id, code: FgosVo.direction_code, name: FgosVo.direction_name, generation: FgosVo.generation }]`) через `fgos_assoc` (обратную связь).**
    *   [x] API для получения деталей ПС (`GET /profstandards/<id>`), **включая полную структуру (ОТФ, ТФ, ТД, НУ, НЗ).**
    *   [x] API для получения списка всех Компетенций (`GET /competencies`) и Индикаторов (`GET /indicators`).
    *   [x] API для ручного создания ПК (`POST /competencies`). *Обновить, чтобы позволять связывать ПК с ТФ (если это требуется по логике).*
    *   [x] API для ручного создания ИПК (`POST /indicators`). *Обновить, чтобы позволять связывать ИПК с конкретными ТД/НУ/НЗ (если это требуется по логике).*
    *   [x] API для ручного обновления ПК (`PATCH /competencies/<id>`).
    *   [x] API для ручного обновления ИПК (`PATCH /indicators/<id>`).
    *   [x] API для ручного удаления ПК (`DELETE /competencies/<id>`).
    *   [x] API для ручного удаления ИПК (`DELETE /indicators/<id>`).
    *   [x] Команда `flask seed_db` для наполнения БД базовыми данными.
    *   [x] **(CLI): Обновить/создать команду `flask parse-profstandard <filepath>` для импорта XML ПС.**

2.  **Фронтенд:**
    *   [x] Базовая структура модуля компетенций с навигацией по вкладкам (`CompetenciesView.vue`).
    *   [x] Вкладка "ОПОП" (`ProgramsView.vue`) с таблицей программ, деталями и возможностью перехода к матрице.
    *   [x] Вкладка "Матрица компетенций" (`MatrixView.vue`).
    *   [x] UI для выбора АУП из внешней БД КД на вкладке "Матрица компетенций".
    *   [x] UI для отображения таблицы матрицы (`MatrixTable.vue`) с дисциплинами (из КД) x ИДК (из локальной БД).
    *   [x] UI для ручного управления связями (чекбоксы) в `MatrixTable.vue` и вызова API `POST/DELETE /matrix/link`.
    *   [x] Переключатель режима просмотра/редактирования матрицы (`ApEditMode.vue`).
    *   [x] Вкладка "ФГОС ВО" (`FgosView.vue`) со списком ФГОС, деталями и интерфейсом для загрузки/предпросмотра/сохранения из PDF.
        *   [x] **(Frontend): `FgosPreviewModal.vue`: Модифицировать отображение "Рекомендованных ПС":
            *   Показывать название (из БД, если есть), код, иконку "загружен" / "не загружен".
            *   Тултип для "не загружен" ПС.**
        *   [x] **(Frontend): `FgosView.vue`: Модифицировать `confirmDeleteFgos`:**
            *   **Добавить 5-секундный таймер обратного отсчета** (кнопка "Удалить" изначально неактивна).
            *   **Предупреждение о каскадном удалении связанных УК/ОПК/ИУК/ИОПК.**
            *   **Удалить чекбокс удаления ПС, т.к. концептуально неверно.**
    *   --- **Страница Профстандартов и Формирования ПК/ИПК** ---
    *   [x] **(Frontend): Создать/Обновить страницу "Профстандарты" (`ProfStandardsView.vue`):**
        *   [x] Отображение списка загруженных ПС (коды, названия).
        *   [x] **Добавить новую колонку "Рекомендация ФГОС"**:
            *   Отображать коды и названия ФГОС ВО, которые рекомендуют данный ПС (получать из `profStandard.recommended_by_fgos`).
            *   **Обеспечить перенос текста на 2-3 строки, если ширины не хватает.**
            *   [x] Интерфейс для загрузки нового ПС (XML-файл).
            *   [x] При выборе ПС из списка – отображение его **детальной структуры** (ОТФ → ТФ → ТД/НУ/НЗ) в удобном иерархическом виде.
    *   [x] **(Frontend): Интегрировать на странице "Профстандарты" (или на отдельной модальной странице) UI для формирования ПК и ИПК на основе данных выбранного ПС:**
        *   **Шаг 1: Формирование ПК.**
            *   [x] Пользователь выбирает ТФ из отображаемой структуры ПС.
            *   [x] Система предлагает код и название ПК на основе выбранной ТФ (пользователь может отредактировать).
            *   [x] Пользователь сохраняет новую ПК (вызов `POST /competencies`).
        *   **Шаг 2: Формирование ИПК для созданной/выбранной ПК.**
            *   [x] Пользователь выбирает конкретные Трудовые Действия (ТД), Необходимые Умения (НУ) и/или Необходимые Знания (НЗ) из ТФ, на основе которой была сформирована ПК.
            *   [x] Система предлагает код и формулировку ИПК на основе выбранных элементов (пользователь может отредактировать).
            *   [x] Пользователь сохраняет новый ИПК, который автоматически связывается с текущей ПК (вызов `POST /indicators`). *Пока без сохранения связей ИПК с ТД/НУ/НЗ в `IndicatorPsLink`.*
    *   [x] Вкладка "Компетенции и Индикаторы" (`CompetenciesIndicatorsView.vue`) со списком всех компетенций и индикаторов. *Должна отображать ПК/ИПК, созданные новым способом.*
    *   [x] UI для ручного обновления ПК/ИПК.
    *   [x] UI для ручного удаления ПК/ИПК.
    *   [x] Адаптированы геттеры в `competenciesMatrix.ts` для работы с обновленными данными из API.
    *   [x] Улучшено отображение связанных данных в таблице компетенций/индикаторов.
    *   [x] Базовая обработка ошибок и статусов загрузки/сохранения в UI.

---

## 4. Задачи Backlog (После MVP / Для ВКР - в перспективе)

*   [ ] **NLP Интеграция:** Подключить NLP для предложений формулировок ИПК (на основе ТД/НУ/НЗ), и для предложения ИУК/ИОПК.
*   [ ] **Связь ИПК с элементами ПС:** Реализовать сохранение и отображение связей между ИПК и конкретными ТД/НУ/НЗ в таблице `IndicatorPsLink`.
*   [ ] **Учет Успеваемости по ИДК:** Связать оценки с ИДК.
*   [ ] **Отчеты:** Генерация матрицы в DOCX и других отчетов.
*   [ ] **Локальное Кэширование/Синхронизация АУП.**
*   [ ] **Тестирование (Unit/Integration).**
*   [ ] **Документация API (более детальная).**
*   [ ] **Оптимизация производительности.**
*   [ ] **Улучшение UI/UX.**