# Задачи по Разработке Веб-приложения "Матрицы Компетенций"

**Проект:** Академический Прогресс / Карты Дисциплин (Бэкенд + Фронтенд)
**Компонент:** `competencies_matrix`
**Версия Документа:** 2.0 *(Обновлено)*
**Дата:** [Текущая дата] *(Обновлено)*

---

## 0. Назначение Источников Данных

*   **ФГОС ВО:**
    *   **Назначение:** Является **источником** для получения **Универсальных (УК)** и **Общепрофессиональных (ОПК)** компетенций, а также **Индикаторов их Достижения (ИУК, ИОПК)**. Также содержит **перечень кодов Профессиональных Стандартов (ПС)**, рекомендованных для использования при формировании **Профессиональных Компетенций (ПК)** для конкретного направления подготовки.
    *   **Действия Пользователя (Методиста/Админа):** Загружает PDF/DOCX файл ФГОС в систему. Просматривает извлеченные УК/ОПК/ИДК и список рекомендованных ПС. Выбирает актуальный ФГОС при работе с Образовательной Программой (ОП).
    *   **Действия Системы:** Парсит загруженный ФГОС, сохраняет его метаданные, УК/ОПК/ИДК и связи с рекомендованными ПС в базу данных. Предоставляет эти данные для просмотра и для автоматического включения УК/ОПК/ИДК в матрицу соответствующей ОП.
    *   **NLP (в перспективе):** Может использоваться для помощи в парсинге сложных PDF или анализа формулировок ИДК на соответствие требованиям.
*   **Профессиональные Стандарты (ПС):**
    *   **Назначение:** Являются **основой** для **формирования Профессиональных Компетенций (ПК)** и **Индикаторов их Достижения (ИПК)**. Содержат описания **Трудовых Функций (ТФ)**, **Трудовых Действий (ТД)**, **Необходимых Умений (НУ)** и **Необходимых Знаний (НЗ)**.
    *   **Действия Пользователя (Методиста):**
        *   Загружает файлы ПС (HTML/DOCX/PDF) в систему.
        *   Выбирает ПС (из рекомендованных ФГОС или загруженных), которые будут использоваться для конкретной ОП.
        *   **Просматривает структуру** выбранного ПС (ОТФ -> ТФ -> ТД/НУ/НЗ).
        *   **Выбирает конкретную ТФ** как основу для формулирования ПК.
        *   **Выбирает конкретные ТД/НУ/НЗ** (относящиеся к выбранной ТФ) как основу для формулирования ИПК.
        *   **Формулирует** текст ПК и ИПК (на основе выбранных элементов ПС).
        *   Сохраняет созданные ПК и ИПК, связывая их с ОП и базовыми элементами ПС.
    *   **Действия Системы:** Парсит загруженный ПС, сохраняет его метаданные и **структуру** (ОТФ, ТФ, ТД, НУ, НЗ) в базу данных. Предоставляет интерфейс для просмотра этой структуры и выбора элементов. Сохраняет созданные пользователем ПК/ИПК и их связи с ПС.
    *   **NLP (в перспективе):**
        *   **Предлагает** варианты формулировок ИПК на основе выбранных ТД/НУ/НЗ.
        *   **Предлагает** связи между ИПК и элементами ПС (ТД/НУ/НЗ).
        *   **Предлагает** связи "Дисциплина ↔ ИДК" в основной матрице.
        *   *Пользователь верифицирует и корректирует предложения NLP.*

---

## 1. Цель и Определение MVP (Minimum Viable Product) - Подтверждено

**Глобальная цель:** Создать веб-приложение (подсистему) для управления матрицами распределения компетенций для ОП Московского Политеха, интегрированное с существующим бэкендом "Карт Дисциплин" и системой аутентификации.

**Цель MVP (До защиты):** Предоставить пользователям (методистам, администраторам) возможность **импортировать данные об АУП** из выгрузок Excel, **просматривать** матрицу компетенций для выбранного АУП, **вручную управлять связями** "Дисциплина-ИДК" в матрице, а также **управлять базовыми справочниками** (ОП, ПК/ИПК), **загружать профстандарты** (сохраняя их как текст/Markdown) и обеспечить базовое **разграничение прав доступа** по ролям.

**Definition of Done (DoD) для MVP (До защиты) - Статус Проверен и Подтвержден:**

1.  [x] Модуль `competencies_matrix` интегрирован в основной бэкенд (`app.py`).
2.  [x] Структура БД соответствует актуальным миграциям Alembic (`structure.md`).
3.  [x] Команда `flask seed_db` выполняется и добавляет **корректные и верифицированные** тестовые данные для таблиц `competencies_*` (примеры ОП, ФГОС, УК/ОПК/ПК, ИУК/ИОПК/ИПК).
4.  [x] Реализован механизм **импорта АУП из Excel-файлов** (предоставленных руководителем/Владом) в таблицы `tbl_aup` и `aup_data` через CLI команду (`flask import-aup`). *Функциональность импорта реализована и протестирована*.
5.  [x] API эндпоинт `GET /api/competencies/programs` **реализован и возвращает 200 OK** со списком ОП.
6.  [x] API эндпоинт `GET /api/competencies/matrix/<aup_id>` возвращает `200 OK`, **корректно отсортированные и отфильтрованные** данные с ожидаемой структурой (Дисциплины, УК/ОПК из базы (от ФГОС), **все** созданные в системе ПК, ИДК, существующие связи).
7.  [x] API эндпоинты `POST /api/competencies/matrix/link` и `DELETE /api/competencies/matrix/link` **полностью реализованы, протестированы** и позволяют корректно создавать/удалять связи в БД.
8.  [x] Реализовано API для **базового CRUD** Образовательных Программ (`/programs`), Компетенций (`/competencies`) и Индикаторов (`/indicators`) **с фокусом на ПК/ИПК** (GET список, GET по ID, POST, PATCH/PUT, DELETE).
9.  [x] Реализовано API (`POST /api/competencies/profstandards/upload`) и логика для **загрузки файла ПС**, вызова `profstandard-lean.py` (или аналога) и сохранения результата (Markdown) в `competencies_prof_standard.parsed_content`.
10. [x] Реализован **минимальный UI** (Frontend), позволяющий:
    *   [ ] Загружать файлы АУП (.xlsx) (если решено делать UI для этого, сейчас через CLI).
    *   [x] Просматривать список ОП.
    *   [x] Выбирать ОП и затем АУП (из импортированных).
    *   [x] Отображать таблицу матрицы ("Дисциплины x ИДК") с чекбоксами.
    *   [x] **Вручную управлять связями** через изменение состояния чекбоксов (вызовы API `POST/DELETE /matrix/link`).
    *   [x] Просматривать список Компетенций/ИДК и базово управлять ПК/ИПК (`CompetenciesAdminView.vue`).
    *   [x] Загружать файлы ПС.
11. [x] API защищено аутентификацией и проверкой одобрения (`@login_required`, `@approved_required`).
12. [x] Реализована **базовая проверка прав доступа** (Админ - всё, Методист - матрица, чтение + CRUD для ПК/ИПК) с использованием декораторов (`@admin_only`) или проверок ролей в логике.

---

## 2. Ближайшие Задачи (После MVP - Фокус на ВКР)

**История 1: Обработка и Структурированное Хранение Исходных Документов (ФГОС, ПС)**

*   **Цель:** Обеспечить систему **структурированными данными** из ФГОС ВО и ПС, необходимыми для ручного и (в будущем) автоматизированного формирования компетенций и индикаторов.
*   **Статус:** [-] **К выполнению**.
*   **Приоритет:** **Высокий (Post-MVP)**.
*   **Задачи:**
    *   **Задача 1.1: Реализовать Парсер ФГОС ВО (PDF/DOCX).**
        *   **Описание:** Создать скрипт/функцию, использующую библиотеки (`pdfminer.six`, `python-docx`) для извлечения текста и таблиц из файлов ФГОС. Определить шаблоны для поиска метаданных, УК/ОПК, ИУК/ИОПК, списка рекомендованных ПС.
        *   **Компоненты:** `competencies_matrix/fgos_parser.py` (новый), `competencies_matrix/models.py`.
    *   **Задача 1.2: Реализовать API/CLI для Загрузки и Парсинга ФГОС.**
        *   **Описание:** Создать эндпоинт (`POST /api/competencies/fgos/upload`) или CLI команду (`flask parse-fgos`) для приема файла, вызова парсера (1.1) и сохранения извлеченных данных в БД (`competencies_fgos_vo`, `competencies_competency`, `competencies_indicator`, `competencies_fgos_recommended_ps`).
        *   **Компоненты:** `competencies_matrix/routes.py`, `competencies_matrix/logic.py`, `cli_commands/` (опц.).
    *   **Задача 1.3: Доработать Парсер Профессиональных Стандартов (ПС).**
        *   **Описание:** Модифицировать существующий парсер (`parsers.py` / `profstandard-lean.py`) для извлечения не только Markdown, но и **структуры**: ОТФ, ТФ, ТД, НУ, НЗ. Обработать разные варианты HTML/DOCX. Результат парсинга - структурированный объект/словарь.
        *   **Компоненты:** `competencies_matrix/parsers.py` (или `profstandard-lean.py`).
    *   **Задача 1.4: Доработать API/CLI Загрузки ПС для Сохранения Структуры.**
        *   **Описание:** Модифицировать `POST /api/competencies/profstandards/upload` (или CLI `flask parse-ps`), чтобы он вызывал доработанный парсер (1.3) и сохранял **всю структуру** (ОТФ, ТФ, ТД, НУ, НЗ) в соответствующие таблицы БД (`competencies_generalized_labor_function`, ...), устанавливая правильные связи с `competencies_prof_standard`.
        *   **Компоненты:** `competencies_matrix/routes.py`, `competencies_matrix/logic.py`, `competencies_matrix/models.py`.
    *   **Задача 1.5: Реализовать UI для Загрузки ФГОС и ПС.**
        *   **Описание:** Создать/доработать интерфейс для загрузки файлов ФГОС и ПС администратором/методистом. Отображение статуса обработки.
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/DocumentUploadView.vue` (или аналог).
    *   **Задача 1.6: Реализовать UI для Просмотра Структуры ПС.**
        *   **Описание:** Создать интерфейс для просмотра иерархической структуры загруженного ПС (ОТФ -> ТФ -> ТД/НУ/НЗ), читая данные из БД.
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/ProfStandardDetailView.vue`, `services/api/competenciesApi.ts`, `stores/profStandardStore.ts`.
    *   **Задача 1.7: Реализовать UI для Просмотра ФГОС (УК/ОПК/ИДК).**
        *   **Описание:** Создать интерфейс для просмотра деталей ФГОС, включая списки УК/ОПК и их ИДК, извлеченных из БД.
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/FgosDetailView.vue`, `services/api/competenciesApi.ts`, `stores/fgosStore.ts`.

**История 2: Ручное Формирование Профессиональных Компетенций (ПК) и Индикаторов (ИПК) на Основе ПС**

*   **Цель:** Предоставить методисту **инструмент для ручного создания ПК и ИПК**, опираясь на структурированные данные ПС, хранящиеся в БД.
*   **Статус:** [-] **К выполнению**.
*   **Приоритет:** **Высокий (Post-MVP)**.
*   **Задачи:**
    *   **Задача 2.1: API и UI для Управления Связями ОП <-> ПС.**
        *   **Описание:** Реализовать возможность для пользователя выбирать, какие из загруженных ПС релевантны для конкретной ОП. Сохранять эти связи в `competencies_educational_program_ps`.
        *   **Компоненты:** `competencies_matrix/routes.py` (`/programs/<id>/profstandards`), `logic.py`, `models.py`, `cabinet_frontend/src/views/competencies/EducationalProgramAdminView.vue`.
    *   **Задача 2.2: Доработка API для Создания/Редактирования ПК.**
        *   **Описание:** Расширить API (`POST/PATCH /competencies` или новые) для явной поддержки создания ПК с возможностью указания ID базовой ТФ (`based_on_labor_function_id`).
        *   **Компоненты:** `competencies_matrix/routes.py`, `logic.py`, `models.py`.
    *   **Задача 2.3: UI для Создания/Редактирования ПК.**
        *   **Описание:** Создать интерфейс, где пользователь может ввести данные ПК и **выбрать базовую ТФ** из структуры ПС (полученной через API из Задачи 1.6).
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/CompetencyEditView.vue` (или компонент в `CompetenciesAdminView.vue`).
    *   **Задача 2.4: Доработка API для Создания/Редактирования ИПК.**
        *   **Описание:** Расширить API (`POST/PATCH /indicators` или новые) для приема **списка ID** связанных элементов ПС (ТД, НУ, НЗ) и сохранения этих связей (например, в `IndicatorPsLink` или новой таблице).
        *   **Компоненты:** `competencies_matrix/routes.py`, `logic.py`, `models.py`.
    *   **Задача 2.5: UI для Создания/Редактирования ИПК.**
        *   **Описание:** Создать интерфейс, где пользователь вводит данные ИПК и может **выбрать (чекбоксами) ТД/НУ/НЗ**, относящиеся к ТФ родительской ПК, для установления связи. Структура ПС для выбора берется из API (Задача 1.6).
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/IndicatorEditView.vue` (или компонент).
    *   **Задача 2.6: Обновление API Матрицы (`GET /matrix/<aup_id>`) для Фильтрации ПК.**
        *   **Описание:** Изменить логику `get_matrix_for_aup`, чтобы в список `competencies` попадали только те ПК, которые релевантны для ОП данного АУП (например, созданные на основе ТФ из ПС, выбранных для этой ОП в `competencies_educational_program_ps`).
        *   **Компоненты:** `competencies_matrix/logic.py`.

---

## 3. Задачи Дальнейшей Перспективы (ВКР - Последующие Итерации)

*   **Задача 3.1:** Интеграция с **NLP-модулем** для:
    *   Предложения связей "Дисциплина ↔ ИДК".
    *   Предложения связей "ИПК ↔ Элементы ПС".
    *   Помощи в формулировании ИПК.
    *   **Компоненты:** `competencies_matrix/logic.py` (вызовы к NLP), `NLP-модуль` (отдельный сервис), `Frontend` (отображение предложений).
*   **Задача 3.2:** Учет **успеваемости по ИДК**.
    *   **Компоненты:** `cabinet/models.py` (доработка `Grade`), `cabinet/logic.py`, `competencies_matrix/*` (для получения ИДК), `Frontend`.
*   **Задача 3.3:** Глубокая **интеграция с Картами Дисциплин** (получение АУП через API).
    *   **Компоненты:** `maps/logic/*`, `competencies_matrix/logic.py`.
*   **Задача 3.4:** **Генерация Отчетов** (матрица в DOCX/PDF, отчеты по покрытию ИДК).
    *   **Компоненты:** `competencies_matrix/reporting.py` (новый), `routes.py`, `Frontend`.
*   **Задача 3.5:** Рефакторинг, Тестирование (unit/integration), Документация API, Описание для ВКР.
    *   **Компоненты:** Все.

---

Этот обновленный список задач фокусируется на последовательном построении функционала, начиная с обработки исходных данных и ручного формирования компетенций/индикаторов, и затем переходя к автоматизации и дополнительным возможностям. Указание затрагиваемых компонентов должно помочь в планировании разработки.