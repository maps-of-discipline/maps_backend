# Задачи по Разработке Веб-приложения "Матрицы Компетенций"

**Проект:** Академический Прогресс / Карты Дисциплин (Бэкенд + Фронтенд)
**Компонент:** `competencies_matrix`
**Версия Документа:** 2.0 *(Обновлено)*
**Дата:** [Текущая дата] *(Обновлено)*

---

## 0. Назначение Источников Данных

*   **ФГОС ВО:**
    *   **Назначение:** Является **источником** для получения **Универсальных (УК)** и **Общепрофессиональных (ОПК)** компетенций, а также **Индикаторов их Достижения (ИУК, ИОПК)**. Также содержит **перечень кодов Профессиональных Стандартов (ПС)**, рекомендованных для использования при формировании **Профессиональных Компетенций (ПК)** для конкретного направления подготовки.
    *   **Действия Пользователя (Методиста/Админа):** Загружает PDF/DOCX файл ФГОС в систему. Просматривает извлеченные УК/ОПК/ИДК и список рекомендованных ПС. Выбирает актуальный ФГОС при работе с Образовательной Программой (ОП).
    *   **Действия Системы:** Парсит загруженный ФГОС, сохраняет его метаданные, УК/ОПК/ИДК и связи с рекомендованными ПС в базу данных. Предоставляет эти данные для просмотра и для автоматического включения УК/ОПК/ИДК в матрицу соответствующей ОП.
    *   **NLP (в перспективе):** Может использоваться для помощи в парсинге сложных PDF или анализа формулировок ИДК на соответствие требованиям.
*   **Профессиональные Стандарты (ПС):**
    *   **Назначение:** Являются **основой** для **формирования Профессиональных Компетенций (ПК)** и **Индикаторов их Достижения (ИПК)**. Содержат описания **Трудовых Функций (ТФ)**, **Трудовых Действий (ТД)**, **Необходимых Умений (НУ)** и **Необходимых Знаний (НЗ)**.
    *   **Действия Пользователя (Методиста):**
        *   Загружает файлы ПС (HTML/DOCX/PDF) в систему.
        *   Выбирает ПС (из рекомендованных ФГОС или загруженных), которые будут использоваться для конкретной ОП.
        *   **Просматривает структуру** выбранного ПС (ОТФ -> ТФ -> ТД/НУ/НЗ).
        *   **Выбирает конкретную ТФ** как основу для формулирования ПК.
        *   **Выбирает конкретные ТД/НУ/НЗ** (относящиеся к выбранной ТФ) как основу для формулирования ИПК.
        *   **Формулирует** текст ПК и ИПК (на основе выбранных элементов ПС).
        *   Сохраняет созданные ПК и ИПК, связывая их с ОП и базовыми элементами ПС.
    *   **Действия Системы:** Парсит загруженный ПС, сохраняет его метаданные и **структуру** (ОТФ, ТФ, ТД, НУ, НЗ) в базу данных. Предоставляет интерфейс для просмотра этой структуры и выбора элементов. Сохраняет созданные пользователем ПК/ИПК и их связи с ПС.
    *   **NLP (в перспективе):**
        *   **Предлагает** варианты формулировок ИПК на основе выбранных ТД/НУ/НЗ.
        *   **Предлагает** связи между ИПК и элементами ПС (ТД/НУ/НЗ).
        *   **Предлагает** связи "Дисциплина ↔ ИДК" в основной матрице.
        *   *Пользователь верифицирует и корректирует предложения NLP.*

---

## 1. Цель и Определение MVP (Minimum Viable Product) - Подтверждено

**Глобальная цель:** Создать веб-приложение (подсистему) для управления матрицами распределения компетенций для ОП Московского Политеха, интегрированное с существующим бэкендом "Карт Дисциплин" и системой аутентификации.

**Цель MVP (До защиты):** Предоставить пользователям (методистам, администраторам) возможность **импортировать данные об АУП** из выгрузок Excel, **просматривать** матрицу компетенций для выбранного АУП, **вручную управлять связями** "Дисциплина-ИДК" в матрице, а также **управлять базовыми справочниками** (ОП, ПК/ИПК), **загружать профстандарты** (сохраняя их как текст/Markdown) и обеспечить базовое **разграничение прав доступа** по ролям.

**Definition of Done (DoD) для MVP (До защиты) - Статус Проверен и Подтвержден:**

1.  [x] Модуль `competencies_matrix` интегрирован в основной бэкенд (`app.py`).
2.  [x] Структура БД соответствует актуальным миграциям Alembic (`structure.md`).
3.  [x] Команда `flask seed_db` выполняется и добавляет **корректные и верифицированные** тестовые данные для таблиц `competencies_*` (примеры ОП, ФГОС, УК/ОПК/ПК, ИУК/ИОПК/ИПК).
4.  [x] Реализован механизм **импорта АУП из Excel-файлов** (предоставленных руководителем/Владом) в таблицы `tbl_aup` и `aup_data` через CLI команду (`flask import-aup`). *Функциональность импорта реализована и протестирована*.
5.  [x] API эндпоинт `GET /api/competencies/programs` **реализован и возвращает 200 OK** со списком ОП.
6.  [x] API эндпоинт `GET /api/competencies/matrix/<aup_id>` возвращает `200 OK`, **корректно отсортированные и отфильтрованные** данные с ожидаемой структурой (Дисциплины, УК/ОПК из базы (от ФГОС), **все** созданные в системе ПК, ИДК, существующие связи).
7.  [x] API эндпоинты `POST /api/competencies/matrix/link` и `DELETE /api/competencies/matrix/link` **полностью реализованы, протестированы** и позволяют корректно создавать/удалять связи в БД.
8.  [ ] Реализовано API для **базового CRUD** Образовательных Программ (`/programs`), Компетенций (`/competencies`) и Индикаторов (`/indicators`) **с фокусом на ПК/ИПК** (GET список, GET по ID, POST, PATCH/PUT, DELETE).
    *   *Статус:* POST реализован (см. 9, 10). GET список/по ID, PATCH/DELETE - **не реализовано**.
9.  [x] API эндпоинт `POST /api/competencies/competencies` реализован и позволяет базово создавать Компетенции.
10. [x] API эндпоинт `POST /api/competencies/indicators` реализован и позволяет базово создавать Индикаторы.
11. [x] Реализовано API (`POST /api/competencies/profstandards/upload`) и логика для **загрузки файла ПС**, вызова `profstandard-lean.py` (или аналога) и сохранения результата (Markdown) в `competencies_prof_standard.parsed_content`.
12. [ ] Реализован **минимальный UI** (Frontend), позволяющий:
    *   [ ] Загружать файлы АУП (.xlsx) (если решено делать UI для этого, сейчас через CLI). **(Необязательно для защиты)**
    *   [x] Просматривать список ОП (`views/competencies/ProgramsView.vue`).
    *   [ ] Выбирать ОП и затем АУП (из импортированных). **(Частично в `MatrixView.vue`, но требует улучшения)**
    *   [x] Отображать таблицу матрицы ("Дисциплины x ИДК") с чекбоксами (`components/competencies/MatrixTable.vue`, `views/competencies/MatrixView.vue`).
    *   [x] **Вручную управлять связями** через изменение состояния чекбокса (`components/competencies/MatrixTable.vue`, `stores/competenciesMatrix.ts`).
    *   [ ] Просматривать список Компетенций/ИДК и базово управлять ПК/ИПК. **(Требует создания нового UI компонента/страницы)**
    *   [ ] Загружать файлы ПС. **(Требует создания UI компонента/страницы)**
13. [x] API защищено аутентификацией и проверкой одобрения (`@login_required`, `@approved_required`).
14. [ ] Реализована **базовая проверка прав доступа** (Админ - всё, Методист - матрица, чтение + CRUD для ПК/ИПК) с использованием декораторов (`@admin_only`) или проверок ролей в логике. **(Необходима проверка применения `@admin_only` там, где требуется, например для загрузки ПС или CRUD ОП/ФГОС)**

---

## 2. Ближайшие Задачи (MVP)

**История 1: Обработка и Структурированное Хранение Исходных Документов (ФГОС, ПС)**

*   **Цель:** Обеспечить систему **структурированными данными** из ФГОС ВО и ПС, необходимыми для ручного и (в будущем) автоматизированного формирования компетенций и индикаторов.
*   **Статус:** [-] **К выполнению**.
*   **Приоритет:** **Давай уже быстрее**.
*   **Задачи:**
    *   [ ] **Задача 1.1 (Backend): Реализовать Парсер ФГОС ВО (PDF/DOCX).**
        *   **Описание:** Создать скрипт/функцию, использующую библиотеки для извлечения текста и таблиц из файлов ФГОС. Определить шаблоны для поиска метаданных, УК/ОПК, ИУК/ИОПК, списка рекомендованных ПС.
        *   **Компоненты:** `competencies_matrix/fgos_parser.py` (новый).
    *   [ ] **Задача 1.2 (Backend/Frontend): Реализовать API/CLI и UI для Загрузки и Парсинга ФГОС.**
        *   **Описание:** Создать эндпоинт (`POST /api/competencies/fgos/upload`) или CLI команду (`flask parse-fgos`) для приема файла, вызова парсера (1.1) и сохранения извлеченных данных в БД. Создать UI для загрузки файла и (опционально) отображения статуса.
        *   **Компоненты:** `competencies_matrix/routes.py`, `competencies_matrix/logic.py`, `cli_commands/` (опц.), `cabinet_frontend/src/views/competencies/FgosView.vue` (новый).
    *   [ ] **Задача 1.3 (Backend): Доработать Парсер Профессиональных Стандартов (ПС).**
        *   **Описание:** Модифицировать существующий парсер (`parsers.py` / `profstandard-lean.py`) для извлечения не только Markdown, но и **структуры**: ОТФ, ТФ, ТД, НУ, НЗ. Сохранять результат как структурированный объект/словарь в Python.
        *   **Компоненты:** `competencies_matrix/parsers.py` (или `profstandard-lean.py`).
    *   [ ] **Задача 1.4 (Backend): Доработать API Загрузки ПС для Сохранения Структуры.**
        *   **Описание:** Модифицировать `POST /api/competencies/profstandards/upload`, чтобы он вызывал доработанный парсер (1.3) и сохранял **всю структуру** (ОТФ, ТФ, ТД, НУ, НЗ) в соответствующие таблицы БД (`competencies_generalized_labor_function`, ...).
        *   **Компоненты:** `competencies_matrix/logic.py`, `competencies_matrix/models.py`.
    *   [ ] **Задача 1.5 (Frontend): Реализовать UI для Просмотра Структуры ПС.**
        *   **Описание:** Доработать `views/competencies/ProfStandardsView.vue` или создать отдельный компонент/страницу для просмотра списка загруженных ПС и их детальной структуры (иерархия ОТФ -> ТФ -> ТД/НУ/НЗ), читая из БД.
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/ProfStandardsView.vue`, `services/api/competenciesApi.ts` (GET /profstandards/<code>), Новые компоненты для отображения структуры ПС.

**История 2: Ручное Формирование Профессиональных Компетенций (ПК) и Индикаторов (ИПК) на Основе ПС**

*   **Цель:** Предоставить методисту **инструмент для ручного создания ПК и ИПК**, опираясь на структурированные данные ПС, хранящиеся в БД.
*   **Статус:** [-] **К выполнению**.
*   **Приоритет:** **Это тоже делай давай**.
*   **Задачи:**
    *   [ ] **Задача 2.1 (Backend/Frontend): API и UI для Управления Связями ОП <-> ПС.**
        *   **Описание:** Реализовать возможность для пользователя выбирать, какие из загруженных ПС релевантны для конкретной ОП. Создать API для получения списка рекомендованных/выбранных ПС для ОП и API для добавления/удаления связей ОП-ПС. Реализовать UI (например, в диалоге деталей ОП или на отдельной странице) для управления этими связями.
        *   **Компоненты:** `competencies_matrix/routes.py`, `logic.py`, `models.py`, `cabinet_frontend/src/views/competencies/ProgramsView.vue` (диалог деталей).
    *   [ ] **Задача 2.2 (Backend/Frontend): Доработка API и UI для Создания ПК.**
        *   **Описание:** Расширить API (`POST /competencies`) и логику `create_competency` для приема `based_on_labor_function_id`. Создать UI форму (например, в `views/competencies/CompetenciesAdminView.vue`) для создания ПК с возможностью **выбора базовой ТФ** из списка ТФ (полученного через API из Задачи 1.5/1.6).
        *   **Компоненты:** `competencies_matrix/routes.py`, `logic.py`, `cabinet_frontend/src/views/competencies/CompetenciesAdminView.vue` (новый UI), `services/api/competenciesApi.ts`.
    *   [ ] **Задача 2.3 (Backend/Frontend): Доработка API и UI для Создания ИПК.**
        *   **Описание:** Расширить API (`POST /indicators`) и логику `create_indicator` для приема **списка ID** связанных элементов ПС (ТД, НУ, НЗ) и сохранения этих связей (`IndicatorPsLink`). Создать UI форму в `views/competencies/CompetenciesAdminView.vue` для создания ИПК с возможностью **выбора (чекбоксами) ТД/НУ/НЗ**, относящихся к ТФ родительской ПК.
        *   **Компоненты:** `competencies_matrix/routes.py`, `logic.py`, `cabinet_frontend/src/views/competencies/CompetenciesAdminView.vue` (новый UI), `services/api/competenciesApi.ts`.
    *   [ ] **Задача 2.4 (Frontend): Реализовать UI для Просмотра и Редактирования Компетенций/Индикаторов (Полный CRUD).**
        *   **Описание:** Создать полноценный интерфейс (например, страница `views/competencies/CompetenciesAdminView.vue`) для просмотра списка всех Компетенций (УК, ОПК, ПК) и Индикаторов (ИУК, ИОПК, ИПК). Реализовать возможности редактирования (PATCH) и удаления (DELETE) для ПК и ИПК. UK/OPK/ИУК/ИОПК обычно не редактируются напрямую, но просмотр нужен.
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/CompetenciesAdminView.vue` (основная страница CRUD), `services/api/competenciesApi.ts` (GET список, GET по ID, PATCH, DELETE для Competency/Indicator).
    *   [ ] **Задача 2.5 (Backend): Доработать API Матрицы (`GET /matrix/<aup_id>`) для Фильтрации ПК.**
        *   **Описание:** Изменить логику `get_matrix_for_aup`, чтобы в список `competencies` попадали только те ПК, которые релевантны для ОП данного АУП (например, созданные на основе ТФ из ПС, выбранных для этой ОП в `competencies_educational_program_ps`).
        *   **Компоненты:** `competencies_matrix/logic.py`.
    *   [ ] **Задача 2.6 (Backend): Добавить в API Матрицы информацию о базовой ТФ для ПК/ИПК.**
        *   **Описание:** В ответе `GET /matrix/<aup_id>` для ПК и ИПК добавлять информацию о базовой ТФ из ПС, на основе которой они были созданы (если такая связь есть). Это может быть полезно для отображения в UI.
        *   **Компоненты:** `competencies_matrix/logic.py` (сериализация).

---

## 3. Задачи Дальнейшей Перспективы (ВКР - Последующие Итерации)

*   [ ] **Задача 3.1:** Интеграция с **NLP-модулем** для:
    *   Предложения связей "Дисциплина ↔ ИДК".
    *   Предложения связей "ИПК ↔ Элементы ПС".
    *   Помощи в формулировании ИПК.
    *   **Компоненты:** `competencies_matrix/logic.py` (вызовы к NLP), `NLP-модуль` (отдельный сервис), `Frontend` (отображение предложений).
*   [ ] **Задача 3.2:** Учет **успеваемости по ИДК**.
    *   **Описание:** Связать оценки в `grades` с конкретными ИДК через новую таблицу. Разработать UI для проставления оценок по ИДК или автоматический расчет на основе оценок по заданиям/контролям.
    *   **Компоненты:** `cabinet/models.py` (доработка `Grade`), `cabinet/logic.py`, `competencies_matrix/*` (для получения ИДК), `Frontend` (интерфейс оценок по ИДК).
*   [ ] **Задача 3.3:** Глубокая **интеграция с Картами Дисциплин** (получение АУП через API).
    *   **Описание:** Вместо прямого чтения моделей maps, использовать API maps, если оно будет разработано.
    *   **Компоненты:** `maps/logic/*`, `competencies_matrix/logic.py`.
*   [ ] **Задача 3.4:** **Генерация Отчетов** (матрица в DOCX/PDF, отчеты по покрытию ИДК, отчеты по освоению ИДК).
    *   **Компоненты:** `competencies_matrix/reporting.py` (новый), `routes.py`, `Frontend`.
*   [ ] **Задача 3.5:** Рефакторинг, Тестирование (unit/integration), Документация API, Описание для ВКР.
    *   **Компоненты:** Все.
*   [ ] **Задача 3.6:** Улучшение UI/UX:
    *   Фильтры, поиск, пагинация в таблицах.
    *   Визуальные индикаторы (например, цветные метки для типов компетенций).
    *   Прогресс-бары загрузки на всех операциях.
    *   Уведомления об успехе/ошибке.

---

Этот обновленный список задач фокусируется на последовательном построении функционала, начиная с обработки исходных данных и ручного формирования компетенций/индикаторов, и затем переходя к автоматизации и дополнительным возможностям. Указание затрагиваемых компонентов должно помочь в планировании разработки.