# Список Задач по Разработке Веб-приложения "Матрицы Компетенций"

**Проект:** Академический Прогресс / Карты Дисциплин (Бэкенд + Фронтенд)
**Компонент:** `competencies_matrix`
**Версия Документа:** 3.5 *(Переработка импорта ПС, фокус на UI формирования ПК)*
**Дата:** 2025-05-12

---

## Глоссарий Сокращений

*(Сохраняем глоссарий без изменений, он находится в файле structure.md)*

---

## 0. Приоритет и Цель MVP (Minimum Viable Product) - До Защиты (ОБНОВЛЕНО)

**Приоритет:** Создать **функциональный и понятный Frontend**, демонстрирующий основной **workflow просмотра и ручного редактирования** матрицы компетенций ("Дисциплина ↔ ИДК"), **просмотр справочников НСИ (ФГОС, ПС, Компетенции, Индикаторы)** и **ручного создания Профессиональных Компетенций (ПК) и Индикаторов их Достижения (ИПК) на основе данных из загруженных Профстандартов**.

**Источник данных:**
*   **Дисциплины АУП:** Получать из **внешней БД "Карты Дисциплин"** через API бэкенда `/api/competencies/external/aups` и `/api/competencies/external/aups/<aup_id>/disciplines`.
*   **УК/ОПК/ИУК/ИОПК:** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db` или `import-fgos`).
*   **Профессиональные Стандарты (ПС) и их структура (ОТФ, ТФ, ТД, НУ, НЗ):** Из **локальной БД** модуля `competencies_matrix` (наполненной **НОВЫМ механизмом импорта из XML/CSV**).
*   **ПК/ИПК:** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db` + **ручной ввод через UI/API с использованием данных из загруженных ПС**).
*   **ФГОС (для просмотра):** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db` или `import-fgos`).
*   **Связи Матрицы:** Из **локальной БД** модуля `competencies_matrix`, управляемой через UI/API `/api/competencies/matrix/link`.

**DoD для MVP (к защите):**
1.  **Бэкенд:**
    *   [x] Настроенный проект с актуальной схемой БД.
    *   [x] Рабочее подключение ко внешней БД КД.
    *   [x] API для поиска АУП из КД (`GET /external/aups`).
    *   [x] API для получения дисциплин АУП из КД (`GET /external/aups/<aup_id>/disciplines`).
    *   [x] API для получения данных матрицы (`GET /matrix/<aup_num>`), использующий дисциплины из КД.
    *   [x] API для ручного создания/удаления связей в матрице (`POST/DELETE /matrix/link`).
    *   [x] API для получения списка и деталей ФГОС (`GET /fgos`, `GET /fgos/<id>`).
    *   [x] API для загрузки, предпросмотра и сохранения ФГОС из PDF (`POST /fgos/upload`, `POST /fgos/save`, `DELETE /fgos/<id>`).
    *   --- **НОВОЕ / ПЕРЕРАБОТКА: Импорт Профстандартов (ПС)** ---
    *   [ ] **(Backend): Переработать `parsers.py` (или создать новый модуль `ps_xml_parser.py`) для парсинга ПС из XML-файлов (формат с `profstandart.rosmintrud.ru` или аналогичный официальный XML).**
        *   [ ] Извлечение метаданных ПС (Код, Название, № приказа, дата приказа, рег. номер, дата рег.).
        *   [ ] Извлечение структуры: ОТФ (код, название, уровень квалиф.), ТФ (код, название, уровень квалиф.), ТД (описание, порядок), НУ (описание, порядок), НЗ (описание, порядок).
    *   [ ] **(Backend): Переработать `logic.save_prof_standard_data` для сохранения полной структуры ПС (ОТФ, ТФ, ТД, НУ, НЗ) в соответствующие таблицы БД.**
    *   [ ] **(Backend): Обновить API `POST /profstandards/upload` для приема XML-файлов, вызова нового парсера и логики сохранения.** *Убрать поддержку DOCX/PDF для ПС, если они не являются официальными источниками для структурированного импорта.*
    *   [x] API для получения списка ПС (`GET /profstandards`). *Обновить, чтобы возвращал только базовую информацию без полной структуры для списка.*
    *   [x] API для получения деталей ПС (`GET /profstandards/<id>`), **включая полную структуру (ОТФ, ТФ, ТД, НУ, НЗ).** *Требует обновления для возврата новой структуры.*
    *   [x] API для получения списка всех Компетенций (`GET /competencies`) и Индикаторов (`GET /indicators`).
    *   [x] API для ручного создания ПК (`POST /competencies`). *Обновить, чтобы позволять связывать ПК с ТФ (если это требуется по логике).*
    *   [x] API для ручного создания ИПК (`POST /indicators`). *Обновить, чтобы позволять связывать ИПК с конкретными ТД/НУ/НЗ (если это требуется по логике).*
    *   [x] API для ручного обновления ПК (`PATCH /competencies/<id>`).
    *   [x] API для ручного обновления ИПК (`PATCH /indicators/<id>`).
    *   [x] API для ручного удаления ПК (`DELETE /competencies/<id>`).
    *   [x] API для ручного удаления ИПК (`DELETE /indicators/<id>`).
    *   [x] Команда `flask seed_db` для наполнения БД базовыми данными.
    *   [ ] **(CLI): Обновить/создать команду `flask import-ps <filepath>` для импорта XML ПС.**

2.  **Фронтенд:**
    *   [x] Базовая структура модуля компетенций с навигацией по вкладкам (`CompetenciesView.vue`).
    *   [x] Вкладка "ОПОП" (`ProgramsView.vue`) с таблицей программ, деталями и возможностью перехода к матрице.
    *   [x] Вкладка "Матрица компетенций" (`MatrixView.vue`).
    *   [x] UI для выбора АУП из внешней БД КД на вкладке "Матрица компетенций".
    *   [x] UI для отображения таблицы матрицы (`MatrixTable.vue`) с дисциплинами (из КД) x ИДК (из локальной БД).
    *   [x] UI для ручного управления связями (чекбоксы) в `MatrixTable.vue` и вызова API `POST/DELETE /matrix/link`.
    *   [x] Переключатель режима просмотра/редактирования матрицы (`ApEditMode.vue`).
    *   [x] Вкладка "ФГОС ВО" (`FgosView.vue`) со списком ФГОС, деталями и интерфейсом для загрузки/предпросмотра/сохранения из PDF.
    *   --- **НОВОЕ / ПЕРЕРАБОТКА: Страница Профстандартов и Формирования ПК/ИПК** ---
    *   [ ] **(Frontend): Создать/Обновить страницу "Профстандарты" (`ProfStandardsView.vue`):**
        *   [ ] Отображение списка загруженных ПС (коды, названия).
        *   [ ] Интерфейс для загрузки нового ПС (XML-файл).
        *   [ ] При выборе ПС из списка – отображение его **детальной структуры** (ОТФ → ТФ → ТД/НУ/НЗ) в удобном иерархическом виде (например, дерево или вложенные раскрывающиеся списки).
    *   [ ] **(Frontend): Интегрировать на странице "Профстандарты" (или на отдельной модальной странице) UI для формирования ПК и ИПК на основе данных выбранного ПС:**
        *   **Шаг 1: Формирование ПК.**
            *   Пользователь выбирает ТФ из отображаемой структуры ПС.
            *   Система предлагает код и название ПК на основе выбранной ТФ (пользователь может отредактировать).
            *   Пользователь сохраняет новую ПК (вызов `POST /competencies`).
        *   **Шаг 2: Формирование ИПК для созданной/выбранной ПК.**
            *   Пользователь выбирает конкретные Трудовые Действия (ТД), Необходимые Умения (НУ) и/или Необходимые Знания (НЗ) из ТФ, на основе которой была сформирована ПК.
            *   Система предлагает код и формулировку ИПК на основе выбранных элементов (пользователь может отредактировать).
            *   Пользователь сохраняет новый ИПК, который автоматически связывается с текущей ПК (вызов `POST /indicators`). *В будущем можно добавить сохранение связей ИПК с выбранными ТД/НУ/НЗ в `IndicatorPsLink`.*
    *   [x] Вкладка "Компетенции и Индикаторы" (`CompetenciesIndicatorsView.vue`) со списком всех компетенций и индикаторов. *Должна отображать ПК/ИПК, созданные новым способом.*
    *   [x] UI для ручного обновления ПК/ИПК.
    *   [x] UI для ручного удаления ПК/ИПК.
    *   [x] Адаптированы геттеры в `competenciesMatrix.ts` для работы с обновленными данными из API.
    *   [x] Улучшено отображение связанных данных в таблице компетенций/индикаторов.
    *   [x] Базовая обработка ошибок и статусов загрузки/сохранения в UI.

---

## 4. Задачи Backlog (После MVP / Для ВКР - в перспективе)

*   [ ] **Детальный Парсинг ФГОС PDF:**
    *   [ ] **(Backend): Доработать `fgos_parser.py` для корректного извлечения УК/ОПК из PDF ФГОС ВО 3++.**
    *   [ ] **(Backend): Доработать `logic.save_fgos_data` для сохранения УК/ОПК.**
*   [ ] **NLP Интеграция:** Подключить NLP для предложений связей и формулировок (для ИДК, связей матрицы).
*   [ ] **Связь ИПК с элементами ПС:** Реализовать сохранение и отображение связей между ИПК и конкретными ТД/НУ/НЗ в таблице `IndicatorPsLink`.
*   [ ] **Учет Успеваемости по ИДК:** Связать оценки с ИДК.
*   [ ] **Отчеты:** Генерация матрицы в DOCX и других отчетов.
*   [ ] **Локальное Кэширование/Синхронизация АУП.**
*   [ ] **Тестирование (Unit/Integration).**
*   [ ] **Документация API (более детальная).**
*   [ ] **Оптимизация производительности.**
*   [ ] **Улучшение UI/UX.**

---

**Порядок Добавления ИДК (с Учетом Нового Подхода к ПС):**

**Обновленный Порядок Формирования ПК и ИПК Пользователем (Методистом):**

1.  **Выбор ОП и Связанного ФГОС:**
    *   Методист на странице "ОПОП" выбирает образовательную программу.
    *   Система отображает информацию об ОП и связанном с ней ФГОС ВО (если он загружен).
    *   На странице деталей ФГОС (или прямо на странице ОП) отображается **список рекомендованных ФГОС'ом Профессиональных Стандартов (ПС)**.

2.  **Переход к Профстандартам:**
    *   Методист может перейти на страницу "Профстандарты".
    *   Если нужного ПС (из числа рекомендованных или дополнительных) нет в системе, методист **загружает его XML-файл**. Система парсит XML и сохраняет структуру ПС (ОТФ, ТФ, ТД, НУ, НЗ) в локальную БД.

3.  **Работа с Конкретным Профстандартом (для формирования ПК/ИПК):**
    *   Методист выбирает из списка загруженных ПС тот, на основе которого он хочет сформировать ПК/ИПК для текущей ОП.
    *   Система отображает **детальную структуру выбранного ПС** (иерархия: ПС → ОТФ → ТФ → ТД/НУ/НЗ).

4.  **Формирование Профессиональной Компетенции (ПК):**
    *   В интерфейсе просмотра структуры ПС методист **выбирает одну Трудовую Функцию (ТФ)**, которая будет основой для новой ПК.
    *   Система может предложить код ПК (например, "ПК-Х") и/или наименование ПК, взяв за основу название выбранной ТФ.
    *   Методист **редактирует/подтверждает** код и наименование ПК.
    *   Методист нажимает "Сохранить ПК". Запрос уходит на `POST /api/competencies/competencies`.
        *   **Важно:** При создании ПК мы можем сохранять связь с `LaborFunction.id`, на основе которой она была создана (если модель `Competency` это позволяет через `based_on_labor_function_id`). Это поможет в будущем для аналитики и отслеживания.

5.  **Формирование Индикатора Достижения ПК (ИПК):**
    *   После создания или выбора существующей ПК (которая была сформирована из ПС), методист переходит к созданию ИПК для нее.
    *   В контексте той же ТФ (из которой была взята ПК), методист **выбирает одно или несколько Трудовых Действий (ТД), и/или Необходимых Умений (НУ), и/или Необходимых Знаний (НЗ)**.
    *   Система может предложить код ИПК (например, "ИПК-Х.Y") и/или формулировку ИПК, агрегируя или перефразируя описания выбранных ТД/НУ/НЗ. **Здесь может быть точка приложения простого NLP в будущем (например, суммаризация).**
    *   Методист **редактирует/подтверждает** код и формулировку ИПК.
    *   Методист нажимает "Сохранить ИПК". Запрос уходит на `POST /api/competencies/indicators` (с указанием `competency_id` родительской ПК).
        *   **Важно:** На этом этапе (для MVP) мы можем **не сохранять явные связи между ИПК и конкретными ТД/НУ/НЗ** в таблице `IndicatorPsLink`, если это усложняет разработку. Достаточно того, что ИПК создан в контексте ПК, которая, в свою очередь, связана с ТФ. Однако, если реализация `IndicatorPsLink` несложна, ее можно включить для большей детализации.

6.  **Использование Созданных ПК/ИПК в Матрице:**
    *   После создания, новые ПК и их ИПК становятся доступны для выбора и установления связей на странице "Матрица компетенций" для соответствующей ОП.