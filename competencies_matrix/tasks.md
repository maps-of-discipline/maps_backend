# Список Задач по Разработке Веб-приложения "Матрицы Компетенций"

**Проект:** Академический Прогресс / Карты Дисциплин (Бэкенд + Фронтенд)
**Компонент:** `competencies_matrix`
**Версия Документа:** 3.1 *(Исправления ошибок и уточнение задач)*
**Дата:** 2025-05-07

---

## Глоссарий Сокращений

*(Сохраняем глоссарий без изменений, он находится в файле structure.md)*

---

## 0. Приоритет и Цель MVP (Minimum Viable Product) - До Защиты

**Приоритет:** Создать **функциональный и понятный Frontend**, демонстрирующий основной **workflow просмотра и ручного редактирования** матрицы компетенций ("Дисциплина ↔ ИДК") и **ручного создания Профессиональных Компетенций (ПК) и Индикаторов их Достижения (ИПК)**, опираясь на данные из внешней **БД "Карты Дисциплин" (КД)** и локальной БД модуля `competencies_matrix`.

**Источник данных:**
*   **Дисциплины АУП:** Получать из **внешней БД "Карты Дисциплин"** через API бэкенда `/api/competencies/external/aups` и `/api/competencies/external/aups/<aup_id>/disciplines`.
*   **УК/ОПК/ИУК/ИОПК:** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db` или импорт ФГОС).
*   **ПК/ИПК:** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db` + **ручной ввод через UI/API**).
*   **ФГОС/ПС (для просмотра):** Из **локальной БД** модуля `competencies_matrix`. Парсинг для MVP достаточен для извлечения метаданных и текста (Markdown). Структура (ТФ, ТД, НУ, НЗ) для MVP не обязательна в структурированном виде.
*   **Связи Матрицы:** Из **локальной БД** модуля `competencies_matrix`, управляемой через UI/API `/api/competencies/matrix/link`.

**DoD для MVP:** Работающий UI для:
1.  Выбора ОП и АУП (из внешней БД КД).
2.  Отображения матрицы (Дисциплины из КД x ИДК из локальной БД).
3.  Ручного редактирования связей в матрице.
4.  Просмотра списка ФГОС и базовых деталей.
5.  Просмотра списка ПС и их текста/Markdown.
6.  Ручного создания/редактирования ПК и ИПК (без интерактивного выбора элементов ПС).
7.  Базовые API для поддержки этого UI.

---

**История 1: Отображение и Ручное Редактирование Матрицы (Высокий Приоритет - MVP)**

*   **Цель:** Пользователь (методист) может выбрать АУП из внешней БД КД, увидеть соответствующую матрицу (Дисциплины из **БД КД** x ИДК из **локальной БД**) и вручную изменить связи (в **локальной БД**).
*   **Задачи:**
    *   [x] **Задача 1.0 (Backend/Config): Настроить подключение ко внешней БД КД.** (Выполнено)
    *   [x] **Задача 1.1 (Backend/Models): Определить SQLAlchemy модели для внешних таблиц КД.** (Выполнено)
    *   [x] **Задача 1.2 (Backend): Реализовать API для поиска АУП по параметрам из БД КД (`GET /external/aups`).** (Выполнено)
    *   [x] **Задача 1.3 (Backend): Реализовать API для получения дисциплин АУП из БД КД (`GET /external/aups/<aup_id>/disciplines`).** (Выполнено)
    *   [x] **Задача 1.4 (Backend): Адаптировать API `GET /matrix/<aup_num>` для использования дисциплин из КД.** (Выполнено. Логика в `logic.py` теперь вызывает `get_external_aup_disciplines` при необходимости.)
    *   [x] **Задача 1.5 (Backend): Верифицировать API `POST/DELETE /matrix/link` для работы с `aup_data_id` из КД.** (Выполнено. Логика в `logic.py` ожидает `aup_data_id` из внешней БД КД.)
    *   [ ] **Задача 1.6 (Frontend): UI для выбора АУП и загрузки матрицы.**
        *   **Описание:** Реализовать на `/competencies/matrix/:aupNum` (вью `MatrixView.vue`):
            *   Отображение фильтров и Dropdown для поиска/выбора АУП из внешней БД КД (используя API Задачи 1.2).
            *   Загрузка данных матрицы (`GET /matrix/<aup_num>`) при выборе АУП.
            *   Обработка и дедупликация сырых записей `aup_data` из ответа API на Frontend (в Pinia Store).
            *   Передача дедуплицированного списка дисциплин и локальных данных компетенций/связей в компонент `MatrixTable`.
            *   Отображение статусов загрузки и ошибок.
        *   **Компоненты:** `MatrixView.vue`, `competenciesMatrix.ts`.
    *   [ ] **Задача 1.7 (Frontend): UI для отображения матрицы и ручного управления связями.**
        *   **Описание:** Доработать компонент `MatrixTable.vue`:
            *   Отображение таблицы "Дедуплицированные Дисциплины" (строки) x "ИДК" (столбцы).
            *   Использование чекбоксов для каждой ячейки.
            *   При изменении состояния чекбокса вызывать экшен в сторе (`toggleMatrixLink`), который отправляет `POST` или `DELETE` запрос на `/api/competencies/matrix/link` с правильными `aup_data_id` (ID представителя дедуплицированной дисциплины) и `indicator_id`.
            *   Отображение статуса загрузки для отдельной операции (например, спиннер на ячейке или общий индикатор).
        *   **Компоненты:** `MatrixTable.vue`, `competenciesMatrix.ts`.

**История 2: Ручное Управление Компетенциями (ПК) и Индикаторами (ИПК) (Средний Приоритет - MVP)**

*   **Цель:** Дать методисту возможность просматривать существующие УК/ОПК/ПК/ИУК/ИОПК/ИПК и вручную создавать новые ПК и ИПК в локальной БД.
*   **Задачи:**
    *   [x] **Задача 2.1 (Backend): Реализовать API для GET Компетенций и Индикаторов (`GET /competencies`, `GET /indicators`).** (Выполнено, базовая реализация)
    *   [x] **Задача 2.2 (Backend): Реализовать API для POST Компетенций (`POST /competencies`) и Индикаторов (`POST /indicators`).** (Выполнено, базовая реализация)
    *   [ ] **Задача 2.3 (Frontend): UI для Просмотра и Добавления Компетенций и Индикаторов.**
        *   **Описание:** Создать страницу/компонент (например, `CompetenciesAdminView.vue`) для:
            *   Отображения списка всех Компетенций (УК, ОПК, ПК) и их Индикаторов из локальной БД (используя API Задачи 2.1).
            *   Реализации формы или модального окна для **создания новой ПК**. Поля: Тип (только ПК для ручного ввода), Код, Название, Описание (textarea), **опционально: привязка к ОП** (выпадающий список ОП из локальной БД).
            *   Реализации формы или модального окна для **создания нового ИПК**. Поля: Родительская Компетенция (выбор из списка ПК), Код, Формулировка (textarea).
            *   Отправка данных на соответствующие API (Задача 2.2).
        *   **Компоненты:** Новый view/компонент (`CompetenciesAdminView.vue`), `competenciesMatrix.ts`.

**История 3: Базовая Работа с ФГОС и ПС (Просмотр) (Средний Приоритет - MVP)**

*   **Цель:** Обеспечить возможность просмотра загруженных ФГОС и ПС в локальной БД для контекста при формировании ПК/ИПК. Глубокий парсинг и интерактивное формирование на их основе - вне MVP.
*   **Задачи:**
    *   [x] **Задача 3.1 (Backend): Реализовать API для Просмотра Списка и Деталей ФГОС (`GET /fgos`, `GET /fgos/<id>`).** (Выполнено)
    *   [x] **Задача 3.2 (Backend): Реализовать API для Загрузки и Сохранения ФГОС (`POST /fgos/upload`, `POST /fgos/save`, `DELETE /fgos/<id>`).** (Выполнено)
    *   [x] **Задача 3.3 (Frontend): UI для Просмотра Списка ФГОС и их Деталей.**
        *   **Описание:** Реализовать на `/competencies/fgos` (вью `FgosView.vue`):
            *   Отображение списка загруженных ФГОС из локальной БД (используя API Задачи 3.1).
            *   Кнопка "Просмотреть", открывающая модальное окно с деталями ФГОС (включая УК/ОПК и их индикаторы, если они есть в БД, и список рекомендованных ПС).
            *   Кнопка "Удалить" ФГОС.
            *   Кнопка "Загрузить ФГОС", инициирующая загрузку файла, парсинг на бэкенде (API Задачи 3.2), и отображение модального окна предпросмотра перед сохранением.
        *   **Компоненты:** `FgosView.vue`, `FgosPreviewModal.vue`, `competenciesMatrix.ts`.
    *   [ ] **Задача 3.4 (Backend): Реализовать API для Просмотра Списка ПС (`GET /profstandards`).**
        *   **Описание:** Возвращать список всех загруженных ПС из локальной БД (метаданные).
        *   **Компоненты:** `competencies_matrix/logic.py`, `routes.py`.
    *   [x] **Задача 3.5 (Backend): Реализовать API для Загрузки и Сохранения ПС (`POST /profstandards/upload`).** (Выполнено. Сохраняет метаданные и Markdown в `ProfStandard`.)
    *   [ ] **Задача 3.6 (Backend): Реализовать API для Просмотра Деталей ПС (`GET /profstandards/<ps_id>`).**
        *   **Описание:** Возвращать метаданные ПС и **Markdown содержимое** (`parsed_content`) из локальной БД. Структура (ОТФ, ТФ и т.д.) пока не нужна в структурированном JSON, достаточно текста.
        *   **Компоненты:** `competencies_matrix/logic.py`, `routes.py`.
    *   [ ] **Задача 3.7 (Frontend): UI для Просмотра Списка ПС и их Содержимого.**
        *   **Описание:** Создать страницу (`ProfStandardsView.vue`) для:
            *   Отображения списка загруженных ПС (используя API Задачи 3.4).
            *   Реализации формы для загрузки нового ПС (вызов API Задачи 3.5).
            *   Кнопки "Просмотреть", открывающей модальное окно с метаданными и **текстом/Markdown содержимым** ПС (используя API Задачи 3.6).
        *   **Компоненты:** `ProfStandardsView.vue`, Новый компонент модального окна (`ProfStandardPreviewModal.vue`), `competenciesMatrix.ts`.

---

## 4. Задачи Backlog (После MVP / Для ВКР)

*   [ ] **Парсинг Структуры ПС:** Доработать парсеры для извлечения ОТФ/ТФ/ТД/НУ/НЗ из HTML/PDF и сохранения в БД в структурированном виде.
*   [ ] **UI Формирования ПК/ИПК:** Создать удобный интерактивный интерфейс для выбора элементов ПС (ТД, НУ, НЗ) и формулирования на их основе ПК/ИПК (как обсуждалось "щелк, щелк, щелк").
*   [ ] **NLP Интеграция:** Подключить NLP для предложений связей и формулировок.
*   [ ] **Учет Успеваемости по ИДК:** Связать оценки с ИДК.
*   [ ] **Отчеты:** Генерация матрицы в DOCX и других отчетов.
*   [ ] **Локальное Кэширование/Синхронизация АУП:** Сохранять данные АУП из КД локально для снижения зависимости.
*   [ ] **Полный CRUD для всех сущностей (ОП, ФГОС, ПС, Компетенции, Индикаторы).**
*   [ ] **Тестирование (Unit/Integration).**
*   [ ] **Документация API.**
*   [ ] **Оптимизация производительности.**
*   [ ] **Улучшение UI/UX.**

---