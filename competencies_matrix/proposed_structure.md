# Структура проекта maps_backend

Ниже представлена детальная структура проекта с описанием назначения каждого модуля и файла.

## Основная структура приложения

```
maps_backend/
├── administration/       # Модуль администрирования системы
│   ├── __init__.py        # Инициализация пакета administration, регистрация Blueprint
│   ├── admin_view.py      # Views для админ-интерфейса на базе Flask-Admin
│   ├── base.py            # Базовые классы и утилиты для админ-views (ModelView, FileAdmin и др.)
│   ├── routes.py          # Роуты для Blueprint администрирования
│   └── crud/              # Специализированные CRUD операции для админки
├── auth/                # Модуль аутентификации и авторизации
│   ├── __init__.py        # Инициализация пакета auth, регистрация Blueprint
│   ├── cli.py             # CLI команды (например, для создания пользователей, ролей)
│   ├── logic.py           # Логика аутентификации и авторизации (логин, JWT токены, права доступа)
│   ├── models.py          # SQLAlchemy модели для пользователей, ролей, прав доступа, токенов
│   └── routes.py          # API endpoints для аутентификации (логин, логаут, регистрация, управление токенами)
├── cabinet/             # Существующий модуль "Академический Прогресс"
│   ├── __init__.py        # Инициализация пакета cabinet, регистрация Blueprint
│   ├── cabinet.py         # Основной файл с Blueprint и роутами для управления:
│   │                        # - дисциплинами
│   │                        # - занятиями и оценками
│   │                        # - студенческими группами
│   │                        # - расписанием
│   │                        # - отчетами
│   ├── models.py          # SQLAlchemy модели для таблиц "Академического кабинета"
│   ├── lib/               # Вспомогательные библиотеки для сложных операций
│   │   ├── generate_discipline_table.py # Генерация таблицы дисциплин
│   │   ├── generate_empty_rpd.py        # Создание рабочих программ дисциплин (РПД)
│   ├── utils/             # Утилиты для работы модуля cabinet
│   │   ├── excel_tools.py # Функции для работы с Excel файлами
│   │   ├── serialize.py   # Функции сериализации моделей для API
│   ├── templates/         # HTML шаблоны кабинета
│   └── static/            # Статические файлы кабинета (CSS, JavaScript)
├── maps/                # Основной модуль "Карты Дисциплин" (содержит модели AUP, Disciplines и т.д.)
│   ├── __init__.py        # Инициализация пакета maps, регистрация Blueprint
│   ├── models.py          # SQLAlchemy модели для таблиц "Карты Дисциплин":
│   │                        # - AupInfo (учебные планы)
│   │                        # - AupData (дисциплины в учебных планах)
│   │                        # - справочники (факультеты, кафедры, группы и т.д.)
│   ├── routes.py          # API endpoints для работы с учебными планами
│   ├── logic/             # Бизнес-логика модуля
│   │   ├── tools.py          # Различные утилиты для работы с учебными планами
│   │   ├── excel_check.py    # Проверки для импорта данных из Excel
│   │   ├── save_into_bd.py   # Функции сохранения данных в БД
│   │   ├── take_from_bd.py   # Функции получения данных из БД
│   │   ├── print_excel.py    # Экспорт данных в Excel
│   │   ├── upload_xml.py     # Экспорт данных в XML
│   │   └── global_variables.py # Глобальные переменные и константы
│   ├── templates/         # HTML шаблоны модуля Maps
│   └── static/            # Статические файлы модуля Maps
├── competencies_matrix/ # <<<--- НАШ НОВЫЙ МОДУЛЬ для работы с компетенциями
│   ├── __init__.py        # Регистрация Blueprint с префиксом /api/competencies
│   ├── routes.py          # API эндпоинты для:
│   │                        # - управления образовательными программами
│   │                        # - работы с компетенциями и ИДК
│   │                        # - управления матрицей компетенций
│   │                        # - загрузки и парсинга профессиональных стандартов
│   ├── models.py          # SQLAlchemy модели для НОВЫХ таблиц:
│   │                        # - образовательные программы (EducationalProgram)
│   │                        # - ФГОС ВО (FgosVo)
│   │                        # - профстандарты (ProfStandard) и их структура
│   │                        # - компетенции (Competency) и индикаторы (Indicator)
│   │                        # - матрица компетенций (CompetencyMatrix)
│   ├── logic.py           # Бизнес-логика: 
│   │                        # - обработка запросов API
│   │                        # - взаимодействие с БД
│   │                        # - бизнес-правила формирования матрицы
│   │                        # - (в перспективе) интеграция с NLP для рекомендаций
│   ├── parsers.py         # Логика парсинга профстандартов (ПС):
│   │                        # - извлечение данных из PDF/HTML
│   │                        # - структурирование ОТФ, ТФ, умений, знаний
│   │                        # - сохранение в БД
│   ├── schemas.py         # Pydantic/Marshmallow схемы для валидации API запросов/ответов
│   └── utils.py           # Вспомогательные функции для модуля
├── unification/         # Модуль унификации (работа с унифицированными дисциплинами)
│   ├── __init__.py        # Инициализация модуля
│   ├── models.py          # Модели данных
│   └── routes.py          # API endpoints
├── utils/               # Общие утилиты приложения
│   ├── __init__.py       
│   └── handlers.py        # Обработчики ошибок, логирование
├── migrations/          # Alembic migrations для управления изменениями схемы БД
├── static/              # Общие статические файлы приложения
│   ├── docx_templates/    # Шаблоны документов Word
│   └── temp/              # Временные файлы
├── .env                 # Файл с переменными окружения (настройки подключения к БД, секреты)
├── .gitignore           # Файл с указанием игнорируемых файлов и папок для Git
├── app.py               # Главный файл приложения Flask:
│                          # - инициализация приложения
│                          # - регистрация всех Blueprint'ов
│                          # - настройка подключения к БД
│                          # - обработка ошибок
├── config.py            # Файл конфигурации приложения:
│                          # - настройки Flask
│                          # - URL-префиксы модулей
│                          # - настройки безопасности
├── Dockerfile           # Файл для сборки Docker образа
├── gunicorn_config.py   # Настройки сервера Gunicorn для production
├── minimal_schema.sql   # Минимальная схема БД для начального запуска
├── proper_schema.sql    # Полная схема БД с детальным описанием всех таблиц
└── requirements.txt     # Файл со списком зависимостей Python
```

## Ключевые аспекты архитектуры

1. **Модульная структура**: Приложение разделено на отдельные модули с помощью Flask Blueprints, что обеспечивает изоляцию функционала и возможность независимой разработки.

2. **ORM-подход**: Используется SQLAlchemy для работы с базой данных, что обеспечивает:
   - Абстракцию от конкретного типа СУБД
   - Типобезопасность и валидацию на уровне моделей
   - Упрощенный доступ к данным через объектно-ориентированный интерфейс

3. **REST API**: Все взаимодействие с фронтендом происходит через RESTful API endpoints с JSON-форматом обмена данными.

4. **Безопасность**: Реализована JWT-аутентификация с системой ролей и разграничения прав доступа.

5. **Интеграция**: Модуль `competencies_matrix` интегрируется в существующую архитектуру:
   - Использует общие модели базы данных из `maps.models`
   - Имеет доступ к единой системе аутентификации из `auth`
   - Следует общим принципам организации кода

## База данных

База данных содержит следующие основные компоненты:

1. **Образовательные программы и стандарты**:
   - ФГОС ВО (`fgos_vo`)
   - Образовательные программы (`educational_programs`)
   - Профессиональные стандарты (`prof_standards`) и их детализация

2. **Учебные планы**:
   - Академические учебные планы (`tbl_aup`)
   - Структура АУП по дисциплинам (`aup_data`)
   - Справочники дисциплин, контроля, периодов и т.д.

3. **Компетенции и матрица**:
   - Компетенции (`competencies`) разных типов (УК, ОПК, ПК)
   - Индикаторы достижения компетенций (`indicators`)
   - Матрица компетенций (`competency_matrix`)
   - Связи индикаторов с элементами профстандартов

4. **Пользователи и доступ**:
   - Пользователи (`tbl_users`)
   - Роли (`roles`) и разрешения
   - Токены доступа (`tbl_token`)

5. **Учебный процесс** (модуль cabinet):
   - Студенты и группы
   - Занятия и оценки
   - Рабочие программы дисциплин