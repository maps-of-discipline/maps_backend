# Список Задач по Разработке Веб-приложения "Матрицы Компетенций"

**Проект:** Академический Прогресс / Карты Дисциплин (Бэкенд + Фронтенд)
**Компонент:** `competencies_matrix`
**Версия Документа:** 3.2 *(Фокус на UI Матрицы и ручном вводе ПК/ИПК, Парсинг в Бэклог)*
**Дата:** 2025-05-11

---

## Глоссарий Сокращений

*(Сохраняем глоссарий без изменений, он находится в файле structure.md)*

---

## 0. Приоритет и Цель MVP (Minimum Viable Product) - До Защиты (ОБНОВЛЕНО)

**Приоритет:** Создать **функциональный и понятный Frontend**, демонстрирующий основной **workflow просмотра и ручного редактирования** матрицы компетенций ("Дисциплина ↔ ИДК") и **ручного создания Профессиональных Компетенций (ПК) и Индикаторов их Достижения (ИПК)**.

**Источник данных:**
*   **Дисциплины АУП:** Получать из **внешней БД "Карты Дисциплин"** через API бэкенда `/api/competencies/external/aups` и `/api/competencies/external/aups/<aup_id>/disciplines`.
*   **УК/ОПК/ИУК/ИОПК:** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db`). **Парсинг PDF ФГОС для автоматического наполнения - в БЭКЛОГЕ.**
*   **ПК/ИПК:** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db` + **ручной ввод через UI/API**).
*   **ФГОС/ПС (для просмотра):** Из **локальной БД** модуля `competencies_matrix` (наполненной через `seed_db`). **Парсинг файлов ПС/ФГОС для детального наполнения - в БЭКЛОГЕ.** Для ПС можно оставить загрузку файла и сохранение только его текста/Markdown.
*   **Связи Матрицы:** Из **локальной БД** модуля `competencies_matrix`, управляемой через UI/API `/api/competencies/matrix/link`.

**DoD для MVP:** Работающий UI для:
1.  Выбора АУП (из внешней БД КД).
2.  Отображения матрицы (Дисциплины из КД x ИДК из локальной БД).
3.  Ручного редактирования связей в матрице.
4.  **Просмотра списка ФГОС и ПС (метаданные и, возможно, текст/Markdown).**
5.  **Ручного создания/редактирования ПК и ИПК (без интерактивного выбора элементов ПС).**
6.  Базовые API для поддержки этого UI.

---

**История 1: Отображение и Ручное Редактирование Матрицы (Высокий Приоритет - MVP)**

*   **Цель:** Пользователь (методист) может выбрать АУП из внешней БД КД, увидеть соответствующую матрицу (Дисциплины из **БД КД** x ИДК из **локальной БД**) и вручную изменить связи (в **локальной БД**).
*   **Задачи:**
    *   [x] **Задача 1.0 (Backend/Config): Настроить подключение ко внешней БД КД.**
    *   [x] **Задача 1.1 (Backend/Models): Определить SQLAlchemy модели для внешних таблиц КД.**
    *   [x] **Задача 1.2 (Backend): Реализовать API для поиска АУП по параметрам из БД КД (`GET /external/aups`).**
    *   [x] **Задача 1.3 (Backend): Реализовать API для получения дисциплин АУП из БД КД (`GET /external/aups/<aup_id>/disciplines`).**
    *   [x] **Задача 1.4 (Backend): Адаптировать API `GET /matrix/<aup_num>` для использования дисциплин из КД.**
    *   [x] **Задача 1.5 (Backend): Верифицировать API `POST/DELETE /matrix/link` для работы с `aup_data_id` из КД.**
    *   [ ] **Задача 1.6 (Frontend): UI для выбора АУП и загрузки матрицы.**
        *   **Описание:** Реализовать на `/competencies/matrix/:aupNum` (вью `MatrixView.vue`):
            *   Отображение фильтров и Dropdown для поиска/выбора АУП из внешней БД КД (используя API Задачи 1.2).
            *   Загрузка данных матрицы (`GET /matrix/<aup_num>`) при выборе АУП.
            *   Обработка и дедупликация сырых записей `aup_data` из ответа API на Frontend (в Pinia Store).
            *   Передача дедуплицированного списка дисциплин и локальных данных компетенций/связей в компонент `MatrixTable`.
            *   Отображение статусов загрузки и ошибок.
        *   **Компоненты:** `MatrixView.vue`, `competenciesMatrix.ts`.
    *   [ ] **Задача 1.7 (Frontend): UI для отображения матрицы и ручного управления связями.**
        *   **Описание:** Доработать компонент `MatrixTable.vue`:
            *   Отображение таблицы "Дедуплицированные Дисциплины" (строки) x "ИДК" (столбцы).
            *   Использование чекбоксов для каждой ячейки.
            *   При изменении состояния чекбокса вызывать экшен в сторе (`toggleMatrixLink`), который отправляет `POST` или `DELETE` запрос на `/api/competencies/matrix/link` с правильными `aup_data_id` (ID представителя дедуплицированной дисциплины) и `indicator_id`.
            *   Отображение статуса загрузки для отдельной операции (например, спиннер на ячейке или общий индикатор).
        *   **Компоненты:** `MatrixTable.vue`, `competenciesMatrix.ts`.

**История 2: Ручное Управление Компетенциями (ПК) и Индикаторами (ИПК) (Высокий Приоритет - MVP)**

*   **Цель:** Дать методисту возможность просматривать существующие УК/ОПК/ПК/ИУК/ИОПК/ИПК и вручную создавать новые ПК и ИПК в локальной БД. Эти данные будут использоваться в матрице.
*   **Задачи:**
    *   [x] **Задача 2.1 (Backend): Реализовать API для GET Компетенций и Индикаторов (`GET /competencies`, `GET /indicators`).** (Базовая реализация есть)
    *   [x] **Задача 2.2 (Backend): Реализовать API для POST Компетенций (`POST /competencies`) и Индикаторов (`POST /indicators`).** (Базовая реализация есть, требует тестирования)
    *   [ ] **Задача 2.3 (Frontend): UI для Просмотра и Добавления Компетенций и Индикаторов.**
        *   **Описание:** Создать страницу/компонент (например, `CompetenciesAdminView.vue` или интегрировать в `/competencies/matrix/`):
            *   Отображения списка всех Компетенций (УК, ОПК, ПК) и их Индикаторов из локальной БД (используя API Задачи 2.1).
            *   Реализации формы или модального окна для **создания новой ПК**. Поля: Тип (только ПК для ручного ввода), Код, Название, Описание (textarea). **Связь с ОП/ФГОС/ПС - пока не обязательна для MVP.**
            *   Реализации формы или модального окна для **создания нового ИПК**. Поля: Родительская Компетенция (выбор из списка ПК), Код, Формулировка (textarea), Источник (текстовое поле для ручного ввода, например "ПС 06.001").
            *   Отправка данных на соответствующие API (Задача 2.2).
        *   **Компоненты:** Новый view/компонент (`CompetenciesAdminView.vue`), `competenciesMatrix.ts`.

**История 3: Базовая Работа с ФГОС и ПС (Просмотр и Ручной ввод метаданных) (Средний Приоритет - MVP)**

*   **Цель:** Обеспечить возможность просмотра списка ФГОС и ПС (метаданные из БД) и, возможно, ручного добавления/редактирования их **метаданных** через UI (без парсинга файлов).
*   **Задачи:**
    *   [x] **Задача 3.1 (Backend): Реализовать API для Просмотра Списка и Деталей ФГОС (`GET /fgos`, `GET /fgos/<id>`).** (Реализовано)
    *   [ ] **Задача 3.2 (Backend): API для ручного CRUD метаданных ФГОС.**
        *   **Описание:** Эндпоинты `POST /fgos`, `PATCH /fgos/<id>`, `DELETE /fgos/<id>` для управления записями `FgosVo` без загрузки PDF.
        *   **Компоненты:** `logic.py`, `routes.py`.
    *   [ ] **Задача 3.3 (Frontend): UI для Просмотра Списка ФГОС и их Деталей + Ручное Управление Метаданными.**
        *   **Описание:** На `/competencies/fgos` (вью `FgosView.vue`):
            *   Отображение списка загруженных ФГОС (API Задачи 3.1).
            *   Кнопка "Просмотреть" (детали ФГОС, УК/ОПК из БД).
            *   **Кнопка "Добавить ФГОС" (ручной ввод метаданных).**
            *   **Кнопка "Редактировать" для существующего ФГОС (редактирование метаданных).**
            *   Кнопка "Удалить".
        *   **Компоненты:** `FgosView.vue`, `FgosFormModal.vue`, `competenciesMatrix.ts`.
    *   [ ] **Задача 3.4 (Backend): Реализовать API для Просмотра Списка и Деталей ПС (`GET /profstandards`, `GET /profstandards/<ps_id>`).** (Детали должны включать Markdown, если он есть)
    *   [ ] **Задача 3.5 (Backend): API для ручного CRUD метаданных ПС и загрузки/связывания Markdown.**
        *   **Описание:** Эндпоинты `POST /profstandards`, `PATCH /profstandards/<id>`, `DELETE /profstandards/<id>` для управления `ProfStandard`. Эндпоинт для загрузки Markdown-файла и привязки его к существующему ПС.
        *   **Компоненты:** `logic.py`, `routes.py`.
    *   [ ] **Задача 3.6 (Frontend): UI для Просмотра Списка ПС, их Содержимого (Markdown) + Ручное Управление Метаданными.**
        *   **Описание:** Страница (`ProfStandardsView.vue`):
            *   Список загруженных ПС.
            *   **Кнопка "Добавить ПС" (ручной ввод метаданных + опциональная загрузка Markdown).**
            *   **Кнопка "Редактировать" (метаданные + Markdown).**
            *   Кнопка "Просмотреть" (метаданные и отображение Markdown).
        *   **Компоненты:** `ProfStandardsView.vue`, `ProfStandardFormModal.vue`, `competenciesMatrix.ts`.

---

## 4. Задачи Backlog (После MVP / Для ВКР)

*   [ ] **Автоматический Парсинг ФГОС PDF (Задача 3.2 из предыдущего списка перенесена сюда):**
    *   [ ] **(Backend): Доработать `fgos_parser.py` для корректного извлечения УК/ОПК и рекомендованных ПС из PDF ФГОС ВО 3++.**
    *   [ ] **(Backend): Доработать `logic.save_fgos_data` для сохранения УК/ОПК и связей с ПС.**
    *   [ ] **(UI): Реализовать UI для загрузки PDF ФГОС, предпросмотра распарсенных данных и сохранения (API `POST /fgos/upload`, `POST /fgos/save`, `DELETE /fgos/<id>`).**
*   [ ] **Автоматический Парсинг ПС (Задача 3.5 из предыдущего списка частично перенесена сюда):**
    *   [ ] **(Backend): Доработать парсеры (`parsers.py`) для извлечения метаданных и текста/Markdown из HTML/DOCX/PDF Профессиональных Стандартов.**
    *   [ ] **(Backend): Доработать `logic.save_prof_standard_data` для сохранения метаданных и Markdown.**
    *   [ ] **(UI): Реализовать UI для загрузки файлов ПС (API `POST /profstandards/upload`).**
*   [ ] **Парсинг Структуры ПС:** Доработать парсеры для извлечения ОТФ/ТФ/ТД/НУ/НЗ из HTML/PDF/Markdown и сохранения в БД в структурированном виде.
*   [ ] **UI Формирования ПК/ИПК из Структуры ПС:** Создать удобный интерактивный интерфейс для выбора элементов ПС (ТД, НУ, НЗ) и формулирования на их основе ПК/ИПК.
*   [ ] **NLP Интеграция:** Подключить NLP для предложений связей и формулировок.
*   [ ] **Учет Успеваемости по ИДК:** Связать оценки с ИДК.
*   [ ] **Отчеты:** Генерация матрицы в DOCX и других отчетов.
*   [ ] **Локальное Кэширование/Синхронизация АУП:** Сохранять данные АУП из КД локально для снижения зависимости.
*   [ ] **Полный CRUD для всех сущностей (ОП, ФГОС, ПС, Компетенции, Индикаторы).**
*   [ ] **Тестирование (Unit/Integration).**
*   [ ] **Документация API.**
*   [ ] **Оптимизация производительности.**
*   [ ] **Улучшение UI/UX.**

---