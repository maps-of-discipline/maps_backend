# Задачи по Разработке Веб-приложения "Матрицы Компетенций"

**Проект:** Академический Прогресс / Карты Дисциплин (Бэкенд + Фронтенд)
**Компонент:** `competencies_matrix`
**Версия Документа:** 3.1 *(Исправления ошибок и уточнение задач)*
**Дата:** 2025-05-07

---

## 0. Приоритет и Цель MVP (Minimum Viable Product) - До Защиты

**Приоритет:** Создать **функциональный и понятный Frontend**, демонстрирующий основной **workflow просмотра и ручного редактирования** матрицы компетенций ("Дисциплина ↔ ИДК").
**Источник данных:**
*   **Дисциплины АУП:** Получать из **БД "Карт Дисциплин" (КД)** через API бэкенда `/api/competencies/external/aups/<aup_id>/disciplines`.
*   **УК/ОПК/ИУК/ИОПК:** Из **локальной БД**, наполненной через `seed_db` или импорт ФГОС.
*   **ПК/ИПК:** Из **локальной БД**, наполненной через `seed_db` + **ручной ввод через UI/API**.
*   **Связи Матрицы:** Из **локальной БД**, управляемой через UI/API `/api/competencies/matrix/link`.
**DoD для MVP:** Работающий UI для выбора ОП/АУП, отображения матрицы, редактирования связей, просмотра/добавления ПК/ИПК. Рабочие API для поддержки этого UI (включая прокси-запросы к КД).

---

**История 1: Отображение и Ручное Редактирование Матрицы (Высокий Приоритет)**

*   **Цель:** Пользователь (методист) может выбрать АУП, увидеть соответствующую матрицу (Дисциплины из **БД КД** x ИДК из **локальной БД**) и вручную изменить связи (в **локальной БД**).
*   **Задачи:**
    *   [x] **Задача 1.0 (Backend/Config): Настроить подключение ко внешней БД КД.**
        *   **Описание:** Добавить настройку подключения во внешней БД в `config.py` с использованием `SQLALCHEMY_BINDS` и переменной окружения.
        *   **Компоненты:** `config.py`.
    *   [x] **Задача 1.1 (Backend/Models): Определить SQLAlchemy модели для внешних таблиц КД.**
        *   **Описание:** Создать файл `external_models.py` и определить в нем модели SQLAlchemy для *минимально необходимых* таблиц внешней БД КД (`tbl_aup`, `aup_data`, `spr_name_op`, `spr_okco`, `spr_form_education`, `spr_degree_education`, `spr_discipline`), не связанные с локальной `db.Model`.
        *   **Компоненты:** `competencies_matrix/external_models.py`.
    *   [x] **Задача 1.2 (Backend): Реализовать API для поиска АУП по параметрам из БД КД.**
        *   **Описание:** Создать эндпоинт `GET /api/competencies/external/aups` с query-параметрами (код ОП, профиль, форма, год, уровень, поиск). Выполнить запрос к моделям внешней БД КД. Вернуть список найденных АУП с базовыми метаданными и общим количеством для пагинации.
        *   **Компоненты:** `competencies_matrix/logic.py`, `routes.py`. **Исправлена ошибка аргументов**.
    *   [x] **Задача 1.3 (Backend): Реализовать API для получения дисциплин АУП из БД КД.**
        *   **Описание:** Создать эндпоинт `GET /api/competencies/external/aups/<int:aup_id>/disciplines`. Выполнить запрос к `aup_data` внешней БД КД. Вернуть список всех *сырых* записей `aup_data` для этого АУП. **Не делать дедупликацию здесь.**
        *   **Компоненты:** `competencies_matrix/logic.py`, `routes.py`. **Исправлено деление ZET на 100.**
    *   [ ] **Задача 1.4 (Frontend): UI для выбора АУП и поиска по параметрам (на основе данных КД).**
        *   **Описание:** На странице Матрицы компетенций (`MatrixView.vue`), реализовать:
            *   Интерфейс для **поиска/фильтрации АУП** по параметрам (код ОП, профиль, форма, год, уровень) и текстовому поиску, используя API Задачи 1.2.
            *   **Отображение списка найденных АУП** (например, в выпадающем списке или таблице с пагинацией).
            *   **Выбор конкретного АУП** из списка, который будет инициировать загрузку данных матрицы и дисциплин для него.
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/MatrixView.vue`, `services/CompetenciesApi.ts`.
    *   [ ] **Задача 1.5 (Frontend): Получение и Обработка Дисциплин для Матрицы (на Frontend).**
        *   **Описание:** В Pinia Store (`competenciesMatrix.ts`), после выбора АУП:
            *   Вызвать API `/api/competencies/external/aups/<aup_id>/disciplines` (Задача 1.3) для получения *сырых* записей `aup_data`.
            *   Выполнить **дедупликацию/группировку** полученных записей `aup_data` по паре "(Семестр, Шифр)" или "(Семестр, Название Дисциплины)" (название из AupData).
            *   Для каждой уникальной пары сохранить ссылку на **один (`aup_data.id`) из исходных дубликатов** (например, первый по порядку) как "представителя" для связывания в матрице.
            *   Сохранить этот **дедуплицированный список** в состоянии стора.
        *   **Компоненты:** `cabinet_frontend/src/stores/competenciesMatrix.ts`.
    *   [ ] **Задача 1.6 (Frontend): Отображение Матрицы с Уникальными Дисциплинами.**
        *   **Описание:** Модифицировать `MatrixTable.vue`:
            *   Строки таблицы должны строиться на основе **дедуплицированного списка "Дисциплина + Семестр"** из состояния стора (Задача 1.5).
            *   Для каждой ячейки (пересечение уникальной дисциплины и ИДК), при клике на чекбокс, вызывать экшн в сторе (`toggleMatrixLink`). Этот экшн должен использовать **ID представителя** из уникальной строки дисциплины и ID ИДК для вызова API `/matrix/link` (Задача 1.8).
        *   **Компоненты:** `cabinet_frontend/src/components/competencies/MatrixTable.vue`, `cabinet_frontend/src/stores/competenciesMatrix.ts`.
    *   [x] **Задача 1.7 (Backend): Адаптировать API `GET /matrix/<aup_id>`.**
        *   **Описание:** Изменить `get_matrix_for_aup` в `competencies_matrix/logic.py` так, чтобы он **НЕ запрашивал AupData** (дисциплины) из локальной БД. Он должен возвращать **только** локальные данные: `LocalAupInfo` (для метаданных АУП), Компетенции/Индикаторы (из локальной БД) и связи Матрицы (из локальной БД).
        *   **Компоненты:** `competencies_matrix/logic.py`, `routes.py`.
    *   [x] **Задача 1.8 (Backend): Верифицировать API `POST/DELETE /matrix/link`.**
        *   **Описание:** Убедиться, что эти API корректно работают с *локальной* таблицей `competencies_matrix`, используя `aup_data_id` как ID из **внешней** БД КД. (Уже сделано в предыдущей итерации).
        *   **Компоненты:** `competencies_matrix/logic.py`, `routes.py`.

**История 2: Ручное Управление Профессиональными Компетенциями (ПК) и Индикаторами (ИПК) (Средний Приоритет)**

*   **Цель:** Дать методисту возможность добавлять и просматривать ПК/ИПК в локальной БД.
*   **Задачи:**
    *   [ ] **Задача 2.1 (Backend): Реализовать API для CRUD ПК/ИПК.**
        *   **Описание:** Доработать API (`/competencies`, `/indicators`) для поддержки базовых операций GET (список, по ID) и POST (создание) для ПК и ИПК в локальной БД. PATCH/DELETE - опционально для MVP.
        *   **Компоненты:** `competencies_matrix/logic.py`, `routes.py`.
    *   [ ] **Задача 2.2 (Frontend): UI для Просмотра и Добавления ПК/ИПК.**
        *   **Описание:** Создать страницу/компонент (`CompetenciesAdminView.vue`?) для отображения списка всех компетенций/индикаторов (из локальной БД). Реализовать форму для добавления новых ПК и ИПК (вызов API POST).
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/CompetenciesAdminView.vue` (новый), `services/CompetenciesApi.ts`.

**История 3: Базовая Работа с ФГОС и ПС (Низкий Приоритет для MVP)**

*   **Цель:** Обеспечить возможность просмотра загруженных ФГОС и ПС в локальной БД. Глубокий парсинг и формирование ПК/ИПК на их основе - **вне MVP**.
*   **Задачи:**
    *   [x] **Задача 3.1 (Backend): Верифицировать API для Просмотра ФГОС.**
        *   **Описание:** Убедиться, что API `GET /fgos` и `GET /fgos/<id>` корректно возвращают данные из локальной БД.
        *   **Компоненты:** `competencies_matrix/logic.py`, `routes.py`.
    *   [x] **Задача 3.2 (Frontend): UI для Просмотра Списка ФГОС.**
        *   **Описание:** Доработать `FgosView.vue` для отображения списка ФГОС из API и открытия модального окна `FgosPreviewModal.vue` для просмотра деталей.
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/FgosView.vue`, `components/competencies/FgosPreviewModal.vue`.
    *   [x] **Задача 3.3 (Backend): Верифицировать API для Загрузки ПС.**
        *   **Описание:** Убедиться, что API `POST /profstandards/upload` корректно принимает файл и сохраняет его текст/Markdown в локальную БД (`competencies_prof_standard`).
        *   **Компоненты:** `competencies_matrix/logic.py`, `routes.py`, `parsers.py`.
    *   [ ] **Задача 3.4 (Frontend): UI для Загрузки и Просмотра Списка ПС.**
        *   **Описание:** Доработать `ProfStandardsView.vue` для отображения списка загруженных ПС (из локальной БД) и реализации формы для загрузки новых файлов ПС. Отображение Markdown - опционально.
        *   **Компоненты:** `cabinet_frontend/src/views/competencies/ProfStandardsView.vue`.

---

## 4. Задачи Backlog (После MVP / Для ВКР)

*   [ ] **Парсинг Структуры ПС:** Реализовать детальный парсинг ОТФ/ТФ/ТД/НУ/НЗ и сохранение в БД.
*   [ ] **UI Формирования ПК/ИПК:** Создать удобный интерфейс для выбора элементов ПС и формулирования на их основе ПК/ИПК.
*   [ ] **NLP Интеграция:** Подключить NLP для предложений связей и формулировок.
*   [ ] **Учет Успеваемости по ИДК:** Связать оценки с ИДК.
*   [ ] **Отчеты:** Генерация матрицы в DOCX и других отчетов.
*   [ ] **Локальное Кэширование/Синхронизация АУП:** Сохранять данные АУП из КД локально для снижения зависимости.
*   [ ] **Полный CRUD для ОП/ФГОС/ПС.**
*   [ ] **Тестирование (Unit/Integration).**
*   [ ] **Документация API.**
*   [ ] **Оптимизация производительности.**
*   [ ] **Улучшение UI/UX.**

---